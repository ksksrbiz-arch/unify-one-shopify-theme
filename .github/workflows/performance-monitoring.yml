name: Deploy to Staging with Lighthouse CI Performance Check\n\non:\n  push:\n    branches: [main]\n    paths-ignore:\n      - '*.md'\n      - '.github/workflows/performance-monitoring.yml'\n\njobs:\n  deploy-staging:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v3\n        with:\n          node-version: '18'\n      \n      - name: Install dependencies\n        run: npm ci\n      \n      # Validate theme files\n      - name: Run Liquid linter\n        run: npm run lint:liquid\n        continue-on-error: true\n      \n      - name: Validate CSS/JS\n        run: npm run lint\n        continue-on-error: true\n      \n      # Deploy to staging theme\n      - name: Deploy to Staging Theme\n        run: |\n          npm install -g @shopify/cli\n          shopify theme push --store=${{ secrets.SHOPIFY_STORE_NAME }} --theme=${{ secrets.SHOPIFY_STAGING_THEME_ID }}\n        env:\n          SHOPIFY_CLI_THEME_TOKEN: ${{ secrets.SHOPIFY_THEME_TOKEN }}\n      \n      # Run Lighthouse CI for performance benchmarking\n      - name: Run Lighthouse CI\n        uses: treosh/lighthouse-ci-action@v10\n        with:\n          urls: |\n            https://${{ secrets.SHOPIFY_STORE_NAME }}/?preview_theme_id=${{ secrets.SHOPIFY_STAGING_THEME_ID }}\n            https://${{ secrets.SHOPIFY_STORE_NAME }}/products/example-product?preview_theme_id=${{ secrets.SHOPIFY_STAGING_THEME_ID }}\n            https://${{ secrets.SHOPIFY_STORE_NAME }}/collections/all?preview_theme_id=${{ secrets.SHOPIFY_STAGING_THEME_ID }}\n          uploadArtifacts: true\n          temporaryPublicStorage: true\n          configPath: './lighthouserc.json'\n      \n      # Check if performance metrics meet budget\n      - name: Verify Performance Budget\n        run: npm run lighthouse:check\n        continue-on-error: true\n      \n      # Post results to PR\n      - name: Comment Performance Results on PR\n        if: github.event_name == 'pull_request'\n        uses: actions/github-script@v6\n        with:\n          script: |\n            const fs = require('fs');\n            const reports = fs.existsSync('./.lighthouseci/reports.json') \n              ? JSON.parse(fs.readFileSync('./.lighthouseci/reports.json', 'utf8'))\n              : [];\n            \n            if (reports.length > 0) {\n              const latest = reports[reports.length - 1];\n              const metrics = latest.categories || {};\n              \n              let comment = '## âš¡ Lighthouse Performance Report\\n\\n';\n              comment += '| Metric | Score |\\n';\n              comment += '|--------|-------|\\n';\n              Object.entries(metrics).forEach(([key, value]) => {\n                const score = Math.round(value.score * 100);\n                const icon = score >= 90 ? 'ðŸŸ¢' : score >= 50 ? 'ðŸŸ¡' : 'ðŸ”´';\n                comment += `| ${icon} ${key} | ${score} |\\n`;\n              });\n              \n              github.rest.issues.createComment({\n                issue_number: context.issue.number,\n                owner: context.repo.owner,\n                repo: context.repo.repo,\n                body: comment\n              });\n            }\n      \n      # Notify Slack of deployment\n      - name: Notify Slack\n        if: always()\n        uses: slackapi/slack-github-action@v1\n        with:\n          payload: |\n            {\n              \"text\": \"ðŸš€ Staging Deployment Complete\",\n              \"blocks\": [\n                {\n                  \"type\": \"section\",\n                  \"text\": {\n                    \"type\": \"mrkdwn\",\n                    \"text\": \"*Staging Deployment Status*\\n*Repository:* ${{ github.repository }}\\n*Branch:* ${{ github.ref_name }}\\n*Status:* ${{ job.status }}\"\n                  }\n                }\n              ]\n            }\n        env:\n          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}\n          SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK\n","sha":""}